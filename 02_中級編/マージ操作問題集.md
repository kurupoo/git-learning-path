# Git中級編：マージ操作問題集
## 〜説明→問題→解説で段階的にマスター〜

### 🎯 学習概要

**学習方式**: 説明→問題→解説の3段階学習  
**学習時間**: 約45分  
**達成レベル**: マージ操作の完全習得  
**前提条件**: Git基礎編の完了

---

## 第1問：Fast-forwardマージ

### 📖 説明
**Fast-forwardマージとは？**

Fast-forwardマージは、最もシンプルなマージパターンです。mainブランチがfeatureブランチの作成後に一切変更されていない場合に発生します。

**特徴:**
- マージコミットが作成されない
- 履歴が一直線に「前進」するだけ
- コンフリクトが発生しない
- 最も安全なマージパターン

### 🎯 問題
新しいfeatureブランチを作成してREADMEファイルを更新し、mainブランチにFast-forwardマージを実行してください。

**実行コマンド:**
```bash
git checkout -b feature-readme-update
vi README.md
# 任意の内容を追加（例：## 🎯 中級編学習開始）
git add README.md
git commit -m "Add 中級編 section to README"
git checkout main
git merge feature-readme-update
git log --oneline -3
```

**期待される結果:**
```
Updating 10efa1d..b1ca271
Fast-forward
 README.md | 7 +++++++
 1 file changed, 7 insertions(+)
```

### 💡 解説
**結果の分析:**
- `Fast-forward` メッセージが表示されたら成功
- `git log` で確認すると、履歴が一直線になっている
- HEADがmainとfeatureブランチの両方を指している状態

**重要ポイント:**
- Fast-forwardは「リスクゼロ」のマージ
- 実際の開発では、mainブランチが変更されていることが多いため、3-wayマージになることが多い

---

## 第2問：3-wayマージ

### 📖 説明
**3-wayマージとは？**

3-wayマージは、mainブランチとfeatureブランチの両方に変更がある場合に発生します。Gitが自動的にマージコミットを作成して、2つの履歴を統合します。

**特徴:**
- マージコミットが自動作成される
- 履歴が分岐・統合のパターンを描く
- 異なるファイルの変更なら自動統合される
- 実際の開発で最も頻繁に発生するパターン

### 🎯 問題
mainブランチとfeatureブランチで異なるファイルを変更し、マージコミットが発生する3-wayマージを実行してください。

**実行コマンド:**
```bash
git checkout -b feature-new-section
echo "# 中級編学習メモ" > "02_中級編/学習メモ.md"
echo "マージ操作の実践中です！" >> "02_中級編/学習メモ.md"
git add "02_中級編/学習メモ.md"
git commit -m "Add 学習メモ in 02_中級編"

git checkout main
echo "更新日: $(date)" >> README.md
git add README.md
git commit -m "Update README with current date"

git merge feature-new-section
git log --oneline --graph -5
```

**期待される結果:**
```
Merge made by the 'ort' strategy.
 "02_中級編/学習メモ.md" | 2 ++
 1 file changed, 2 insertions(+)

# git log --graph の結果：
*   cf68508 (HEAD -> main) Merge branch 'feature-new-section'
|\  
| * bfdb576 Add 学習メモ in 02_中級編
* | 20c1a02 Update README with current date
|/  
```

### 💡 解説
**結果の分析:**
- `Merge made by the 'ort' strategy` がGitの自動マージ実行の証拠
- マージコミット（cf68508）が新規作成された
- `git log --graph` で分岐・統合の美しい履歴パターンが確認できる

**重要ポイント:**
- 異なるファイルの変更なら、Gitが自動的に統合してくれる
- チーム開発では、このパターンが最も一般的
- マージコミットには2つの親コミットが存在する

---

## 第3問：コンフリクト解決

### 📖 説明
**コンフリクトとは？**

コンフリクト（競合）は、同じファイルの同じ箇所を異なる内容で変更した場合に発生します。Gitが自動的に統合できないため、人間が手動で解決する必要があります。

**コンフリクトが発生する条件:**
- 同じファイルの同じ行を変更
- 一方で行を削除、もう一方で同じ行を変更
- ファイルの移動や削除に関する競合

**コンフリクトマーカーの意味:**
```
<<<<<<< HEAD
現在のブランチの内容
=======
マージしようとするブランチの内容
>>>>>>> ブランチ名
```

### 🎯 問題
同じファイルの同じ箇所を異なる内容で変更し、コンフリクトを発生させて手動で解決してください。

**実行コマンド:**
```bash
# 1. featureブランチで変更
git checkout -b feature-conflict-test
vi README.md
# 末尾に以下を追加：
# ## 学習進捗
# - 基礎編: 完了 ✅
# - 中級編: 進行中（マージ操作学習中）🚧

git add README.md
git commit -m "Add 学習進捗 section from feature branch"

# 2. mainブランチで同じ箇所を違う内容で変更
git checkout main
vi README.md
# 末尾に以下を追加：
# ## 現在の状況
# - Git基礎: マスター済み
# - Git中級: マージ操作を実践中

git add README.md
git commit -m "Add 現在の状況 from main branch"

# 3. コンフリクト発生
git merge feature-conflict-test
git status
```

**期待される結果（コンフリクト発生）:**
```
Auto-merging README.md
CONFLICT (content): Merge conflict in README.md
Automatic merge failed; fix conflicts and then commit the result.
```

**コンフリクト解決手順:**
```bash
# 4. コンフリクト内容確認
cat README.md

# 5. 手動解決
vi README.md
# コンフリクトマーカーを削除し、内容を統合

# 6. 解決をコミット
git add README.md
git commit -m "Resolve merge conflict in README.md"

# 7. 最終確認
git log --oneline --graph -8
```

### 💡 解説
**コンフリクト解決の流れ:**
1. **発生**: `CONFLICT (content)` メッセージでコンフリクト発生を確認
2. **状況確認**: `git status` で競合ファイルを特定
3. **内容確認**: コンフリクトマーカーの内容を理解
4. **手動解決**: マーカーを削除し、適切に内容を統合
5. **解決完了**: `git add` → `git commit` で解決をコミット

**重要ポイント:**
- コンフリクトマーカー（`<<<<<<<`, `=======`, `>>>>>>>`）は全て削除する
- 両方の変更を活かす、片方を選ぶ、新しい内容にするなど、状況に応じて判断
- 解決後は必ず動作確認を行う（重要！）

**最終的な履歴:**
```
*   e7ffdda (HEAD -> main) Resolve merge conflict in README.md
|\  
| * 72ab901 Add 学習進捗 section from feature branch
* | c3e1e16 Add 現在の状況 from main branch
|/  
```

---

## 🎯 よくある間違いと対処法

### ❌ 間違い1: コンフリクトマーカーをそのまま残す
**問題**: `<<<<<<< HEAD` などをファイルに残したままコミット

**対処法**: エディタで確実にマーカーを全て削除し、統合された内容のみ残す

### ❌ 間違い2: マージを途中で中断したい
**問題**: コンフリクト解決が複雑で、マージをやり直したい

**対処法**: 
```bash
git merge --abort  # マージを取り消し
```

### ❌ 間違い3: どのブランチにいるか確認不足
**問題**: 意図しないブランチでマージしてしまう

**対処法**: マージ前に必ず現在の状況を確認
```bash
git status
git branch
```

---

## 🏆 習得したスキル

### ✅ マージの3パターン理解
- **Fast-forward**: シンプルな前進マージ
- **3-way**: 分岐・統合マージ
- **Conflict**: 手動解決マージ

### ✅ 実践的コマンド
- `git merge <ブランチ名>` - マージ実行
- `git merge --abort` - マージ取り消し
- `git log --oneline --graph` - 履歴の視覚的確認

### ✅ コンフリクト解決スキル
- コンフリクトマーカーの読み方
- 手動での適切な統合判断
- 解決後の確認・テスト

---

## 🚀 実際の開発での活用

### チーム開発での典型的フロー
```bash
git checkout main
git pull origin main        # 最新取得
git checkout -b feature-xyz
# ... 開発作業 ...
git add .
git commit -m "Add feature xyz"
git checkout main
git pull origin main        # 念のため再確認
git merge feature-xyz       # マージ実行
# コンフリクト発生時は手動解決
git push origin main
git branch -d feature-xyz   # 不要ブランチ削除
```

### 安全なマージのためのチェックリスト
- ✅ マージ前の `git status` 確認
- ✅ 最新のmainブランチを取得済み
- ✅ 重要な変更は事前にバックアップ
- ✅ コンフリクト解決後は動作テスト実施
- ✅ チーム開発ではPull Request活用

---

*Created by: Git実践学習プログラム*  
*Learning Method: 説明→問題→解説による段階的習得*  
*実践日: 2025年9月25日*
